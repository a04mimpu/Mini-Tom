<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <title>Best√§llning</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      margin: 50px auto;
      background-color: #f3f9ff;
      max-width: 600px;
    }
    input, button {
      padding: 10px;
      font-size: 16px;
      width: 80%;
      margin: 10px auto;
      display: block;
    }
    .suggestions {
      margin-top: 20px;
      font-size: 14px;
      color: #333;
    }
    .agent {
      font-size: 100px;
      transition: transform 0.3s ease;
      margin-bottom: 10px;
    }
    .correction {
      margin-top: 10px;
    }
    .correction button {
      background-color: #fefefe;
      border: 1px solid #aaa;
      font-size: 14px;
      padding: 8px;
      cursor: pointer;
    }
    .cart {
      background-color: #ffffff;
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 15px;
      margin-top: 20px;
      max-width: 500px;
      margin-left: auto;
      margin-right: auto;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 12px;
      border-bottom: 1px solid #eee;
      font-size: 16px;
    }
    .cart-item button {
      background: none;
      border: none;
      color: crimson;
      font-size: 20px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <div class="agent" id="tom-emoji">ü§ñ</div>

  <h1>Mini-Toms Best√§llningshj√§lp</h1>
  <p>Skriv eller s√§g vad du vill best√§lla s√• hj√§lper Tom dig!</p>

  <input type="text" id="userInput" placeholder="Ex: Jag vill best√§lla en iPhone 15" />
  <button onclick="tolkaBest√§llning()">Tolka</button>
  <button onclick="startaR√∂st()">üé§ S√§g din best√§llning</button>

  <input type="text" id="produkt" placeholder="Produktnamn" readonly />
  <div class="suggestions" id="relaterade"></div>
  <div class="correction" id="f√∂rslag"></div>
  <div class="cart">
    <h2>üõí Din varukorg</h2>
    <div id="cartList"></div>
  </div>

<script>
  const cart = [];

  function uppdateraKorg() {
    const cartList = document.getElementById("cartList");
    if (cart.length === 0) {
      cartList.innerHTML = "<em>Varukorgen √§r tom.</em>";
      return;
    }

    cartList.innerHTML = cart.map((item, index) => `
      <div class="cart-item">
        <span>${item}</span>
        <button onclick="taBort(${index})">‚ùå</button>
      </div>
    `).join("");
  }

  function taBort(index) {
    cart.splice(index, 1);
    uppdateraKorg();
  }

  function h√§mtaFr√•nURL() {
    const params = new URLSearchParams(window.location.search);
    return params.get("fraga") || "";
  }

  function tolkaInput(input) {
    const lower = input.toLowerCase();
    let produkt = "";
    let tillbeh√∂r = [];
    let fel = false;
    let f√∂rslag = "";

    if (
      lower.includes("iphone 150") ||
      lower.includes("iphone150") ||
      lower.includes("i phone 150")
    ) {
      fel = true;
      f√∂rslag = "iPhone 15";
    } else if (lower.includes("iphone 15")) {
      produkt = "iPhone 15";
      tillbeh√∂r = ["Sk√§rmskydd", "MagSafe-laddare", "AirPods"];
    } else if (lower.includes("airpods")) {
      produkt = "AirPods Pro";
      tillbeh√∂r = ["Laddningsetui", "Ear tips", "Lightning-kabel"];
    } else if (lower.includes("galaxy s24")) {
      produkt = "Samsung Galaxy S24";
      tillbeh√∂r = ["Skal", "Tr√•dl√∂s laddare", "Galaxy Buds"];
    } else if (lower.includes("iphone")) {
      produkt = "iPhone (modell saknas)";
      tillbeh√∂r = ["Sk√§rmskydd", "Laddare"];
    } else {
      fel = true;
    }

    return { produkt, tillbeh√∂r, fel, f√∂rslag };
  }

  function visaFelmeddelande(f√∂rslag) {
    document.getElementById("produkt").value = "";
    document.getElementById("relaterade").innerHTML = "<em>ü§î Men vad menar du nu?</em>";
    document.getElementById("tom-emoji").innerText = "üò†";

    const utterance = new SpeechSynthesisUtterance(
      f√∂rslag
        ? `Men vad menar du nu? Menade du ${f√∂rslag}?`
        : "Men vad menar du nu?"
    );
    utterance.lang = "sv-SE";
    speechSynthesis.speak(utterance);

    if (f√∂rslag) {
      document.getElementById("f√∂rslag").innerHTML = `
        <button onclick="r√§ttaTill('${f√∂rslag}')">Ja, jag menade ${f√∂rslag}</button>
      `;
    }
  }

  function visaResultat(produkt, tillbeh√∂r) {
    document.getElementById("produkt").value = produkt;
    document.getElementById("tom-emoji").innerText = "üòÑ";
    document.getElementById("f√∂rslag").innerHTML = "";

    const relaterade = document.getElementById("relaterade");
    if (tillbeh√∂r.length > 0) {
      relaterade.innerHTML = `<strong>Relaterade artiklar:</strong><br>‚Ä¢ ${tillbeh√∂r.join("<br>‚Ä¢ ")}`;
    } else {
      relaterade.innerHTML = "";
    }

    // L√§gg i korgen
    cart.push(produkt);
    uppdateraKorg();
  }

  function tolkaBest√§llning() {
    const input = document.getElementById("userInput").value;
    const { produkt, tillbeh√∂r, fel, f√∂rslag } = tolkaInput(input);
    if (fel) {
      visaFelmeddelande(f√∂rslag);
    } else {
      visaResultat(produkt, tillbeh√∂r);
    }
  }

  function r√§ttaTill(korrekt) {
    const emoji = document.getElementById("tom-emoji");
    const produktf√§lt = document.getElementById("produkt");
    const relaterade = document.getElementById("relaterade");
    const f√∂rslagRuta = document.getElementById("f√∂rslag");

    document.getElementById("userInput").value = "Jag vill best√§lla en " + korrekt;
    emoji.innerText = "üòÑ";

    if (speechSynthesis.speaking) speechSynthesis.cancel();

    const braVal = new SpeechSynthesisUtterance(`Bra val! ${korrekt} √§r ett utm√§rkt val.`);
    const bekr√§fta = new SpeechSynthesisUtterance("Din best√§llning √§r mottagen!");

    braVal.lang = "sv-SE";
    bekr√§fta.lang = "sv-SE";

    braVal.onend = () => speechSynthesis.speak(bekr√§fta);
    speechSynthesis.speak(braVal);

    produktf√§lt.value = korrekt;
    f√∂rslagRuta.innerHTML = "";
    relaterade.innerHTML = `
      <strong>Relaterade artiklar:</strong><br>
      ‚Ä¢ Sk√§rmskydd<br>
      ‚Ä¢ MagSafe-laddare<br>
      ‚Ä¢ AirPods
    `;

    cart.push(korrekt);
    uppdateraKorg();
  }

  function startaR√∂st() {
    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = "sv-SE";
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;

    recognition.onresult = (event) => {
      const transcript = event.results[0][0].transcript;
      document.getElementById("userInput").value = transcript;
      tolkaBest√§llning();
    };

    recognition.onerror = (event) => {
      alert("Kunde inte k√§nna igen r√∂st: " + event.error);
    };

    recognition.start();
  }

  window.onload = function () {
    const fr√•ga = h√§mtaFr√•nURL();
    if (fr√•ga.trim() !== "") {
      document.getElementById("userInput").value = fr√•ga;
      tolkaBest√§llning();
    } else {
      uppdateraKorg();
    }
  };
</script>

</body>
</html>
