<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <title>Best√§llning</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      margin: 50px auto;
      background-color: #f3f9ff;
      max-width: 600px;
    }
    input, button {
      padding: 10px;
      font-size: 16px;
      width: 80%;
      margin: 10px auto;
      display: block;
    }
    .suggestions, .cart {
      margin-top: 20px;
      font-size: 14px;
      color: #333;
    }
    .agent {
      font-size: 100px;
      margin-bottom: 10px;
    }
    .correction button {
      margin-top: 10px;
      background-color: #fefefe;
      border: 1px solid #aaa;
      padding: 8px;
      cursor: pointer;
    }
    .cart-item {
      display: flex;
      justify-content: space-between;
      padding: 5px 20px;
      border-bottom: 1px solid #ccc;
    }
    .cart-item button {
      background: none;
      border: none;
      color: red;
      font-size: 16px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <div class="agent" id="tom-emoji">ü§ñ</div>
  <h1>Mini-Toms Best√§llningshj√§lp</h1>
  <p>Skriv vad du vill best√§lla s√• hj√§lper Tom dig!</p>

  <input type="text" id="userInput" placeholder="Ex: Jag vill best√§lla en iPhone 15" />
  <button onclick="tolkaBest√§llning()">Tolka</button>

  <input type="text" id="produkt" placeholder="Produktnamn" readonly />
  <div class="suggestions" id="relaterade"></div>
  <div class="correction" id="f√∂rslag"></div>

  <h2>üõí Varukorg</h2>
  <div class="cart" id="cartList"></div>

  <script>
    function tolkaInput(input) {
      const lower = input.toLowerCase();
      let produkt = "";
      let tillbeh√∂r = [];
      let fel = false;
      let f√∂rslag = "";

      if (lower.includes("iphone 150")) {
        fel = true;
        f√∂rslag = "iPhone 15";
      } else if (lower.includes("iphone 15")) {
        produkt = "iPhone 15";
        tillbeh√∂r = ["Sk√§rmskydd", "MagSafe-laddare", "AirPods"];
      } else if (lower.includes("airpods")) {
        produkt = "AirPods Pro";
        tillbeh√∂r = ["Laddningsetui", "Ear tips", "Lightning-kabel"];
      } else if (lower.includes("galaxy s24")) {
        produkt = "Samsung Galaxy S24";
        tillbeh√∂r = ["Skal", "Tr√•dl√∂s laddare", "Galaxy Buds"];
      } else if (lower.includes("iphone")) {
        produkt = "iPhone (modell saknas)";
        tillbeh√∂r = ["Sk√§rmskydd", "Laddare"];
      } else {
        fel = true;
      }

      return { produkt, tillbeh√∂r, fel, f√∂rslag };
    }

    function visaFelmeddelande(f√∂rslag) {
      document.getElementById("produkt").value = "";
      document.getElementById("relaterade").innerHTML = "<em>ü§î Men vad menar du nu?</em>";
      document.getElementById("tom-emoji").innerText = "üò†";

      const utterance = new SpeechSynthesisUtterance(
        f√∂rslag ? `Men vad menar du nu? Menade du ${f√∂rslag}?` : "Men vad menar du nu?"
      );
      utterance.lang = "sv-SE";
      speechSynthesis.speak(utterance);

      if (f√∂rslag) {
        document.getElementById("f√∂rslag").innerHTML = `
          <button onclick="r√§ttaTill('${f√∂rslag}')">Ja, jag menade ${f√∂rslag}</button>
        `;
      }
    }

    function visaResultat(produkt, tillbeh√∂r) {
      document.getElementById("produkt").value = produkt;
      document.getElementById("tom-emoji").innerText = "üòÑ";
      document.getElementById("f√∂rslag").innerHTML = "";

      const relaterade = document.getElementById("relaterade");
      relaterade.innerHTML = tillbeh√∂r.length > 0
        ? `<strong>Relaterade artiklar:</strong><br>‚Ä¢ ${tillbeh√∂r.join("<br>‚Ä¢ ")}`
        : "";

      // Tal + l√§gg i korg
      const t1 = new SpeechSynthesisUtterance(`Bra val! ${produkt} √§r ett utm√§rkt val.`);
      const t2 = new SpeechSynthesisUtterance("Din best√§llning √§r mottagen!");
      t1.lang = t2.lang = "sv-SE";
      t1.onend = () => speechSynthesis.speak(t2);
      speechSynthesis.speak(t1);

      l√§ggTillIKorgen(produkt);
    }

    function tolkaBest√§llning() {
      const input = document.getElementById("userInput").value;
      const { produkt, tillbeh√∂r, fel, f√∂rslag } = tolkaInput(input);
      if (fel) {
        visaFelmeddelande(f√∂rslag);
      } else {
        visaResultat(produkt, tillbeh√∂r);
      }
    }

    function r√§ttaTill(korrekt) {
      document.getElementById("userInput").value = "Jag vill best√§lla en " + korrekt;
      tolkaBest√§llning();
    }

    function l√§ggTillIKorgen(produkt) {
      let korg = JSON.parse(localStorage.getItem("varukorg") || "[]");
      korg.push(produkt);
      localStorage.setItem("varukorg", JSON.stringify(korg));
      visaKorg();
    }

    function taBortProdukt(index) {
      let korg = JSON.parse(localStorage.getItem("varukorg") || "[]");
      korg.splice(index, 1);
      localStorage.setItem("varukorg", JSON.stringify(korg));
      visaKorg();
    }

    function visaKorg() {
      const list = document.getElementById("cartList");
      const korg = JSON.parse(localStorage.getItem("varukorg") || "[]");
      if (korg.length === 0) {
        list.innerHTML = "<em>Din varukorg √§r tom.</em>";
        return;
      }
      list.innerHTML = korg.map((item, i) =>
        `<div class="cart-item">${item} <button onclick="taBortProdukt(${i})">‚ùå</button></div>`
      ).join("");
    }

    window.onload = () => {
      visaKorg();
    };
  </script>
</body>
</html>
