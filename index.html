<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <title>Tom</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      margin-top: 50px;
      background-color: #f9f9f9;
    }
    .agent {
      font-size: 100px;
      transition: transform 0.3s ease;
    }
    .agent.blink {
      transform: scale(1.1);
    }
    #response {
      margin-top: 20px;
      font-size: 20px;
      color: #444;
    }
    input, button {
      padding: 10px;
      font-size: 16px;
      margin: 10px;
    }
  </style>
</head>
<body>

  <div class="agent" id="agent">ü§ñ</div>

  <h1>Mini-Toms Best√§llningshj√§lp</h1>
  <p>Skriv eller s√§g n√•got till Mini-Tom!</p>

  <input type="text" id="input" placeholder="Skriv n√•got till Mini-Tom..." />
  <br>
  <button onclick="ask()">Fr√•ga</button>
  <button onclick="startaTaligenk√§nning()">üé§ S√§g din best√§llning</button>

  <div id="response"></div>

<script>
  async function ask() {
    const input = document.getElementById("input").value.trim();
    const agent = document.getElementById("agent");
    const responseBox = document.getElementById("response");

    agent.classList.add("blink");
    setTimeout(() => agent.classList.remove("blink"), 300);

    const normalized = input.toLowerCase();

    // Emoji-reaktion
    if (normalized.includes("arg")) {
      agent.innerText = "üò†";
    } else if (normalized.includes("ledsen")) {
      agent.innerText = "üò¢";
    } else if (normalized.includes("kul") || normalized.includes("roligt")) {
      agent.innerText = "üòÑ";
    } else if (normalized.includes("kram")) {
      agent.innerText = "ü§ó";
    } else {
      agent.innerText = "ü§ñ";
    }

    // Trigger: best√§llning
    const best√§llningsfraser = [
      "skapa best√§llning",
      "jag vill skapa en best√§llning",
      "best√§llning",
      "jag vill best√§lla",
      "g√∂ra en best√§llning",
      "skapa en order",
      "ny best√§llning"
    ];

    const match = best√§llningsfraser.some(fras => normalized.includes(fras));

    if (match) {
      const svar = "Javisst, jag hj√§lper dig!";
      responseBox.innerText = svar;

      const utterance = new SpeechSynthesisUtterance(svar);
      utterance.lang = "sv-SE";
      speechSynthesis.speak(utterance);

      setTimeout(() => {
        const encoded = encodeURIComponent(input);
        window.location.href = `bestallning.html?fraga=${encoded}`;
      }, 3000);
      return;
    }

    // Standard-svar
    const svar = "Hmm... det m√•ste jag fundera lite mer p√•.";
    responseBox.innerText = svar;

    const utterance = new SpeechSynthesisUtterance(svar);
    utterance.lang = "sv-SE";
    speechSynthesis.speak(utterance);
  }

  function startaTaligenk√§nning() {
    if (!('webkitSpeechRecognition' in window)) {
      alert("Din webbl√§sare st√∂djer inte taligenk√§nning.");
      return;
    }

    const recognition = new webkitSpeechRecognition();
    recognition.lang = "sv-SE";
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;

    recognition.onresult = function (event) {
      const talText = event.results[0][0].transcript;
      document.getElementById("input").value = talText;
      ask();
    };

    recognition.onerror = function (event) {
      alert("Fel vid taligenk√§nning: " + event.error);
    };

    recognition.start();
  }
</script>

</body>
</html>

